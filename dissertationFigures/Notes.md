### Experiment 1: Behavioural 60 days
```julia
[ Info: Functions set: Behavioural
[ Info: [ 2]  : 0.00906723112551376,  0.0783953848461613
[ Info: [ 5]  : 0.01632464794896272,  0.11358495443839277
[ Info: [ 10] : 0.020434711570278846, 0.08962561422970608
[ Info: [ 15] : 0.013841716773875554, 0.040187386371491385
[ Info: [ 20] : 0.017468641370562223, 0.08986057376634213
[ Info: [ 25] : 0.031587631727219165, 0.0915045920596121
[ Info: [ 30] : 0.046035379523875285, 0.014767147278958927
[ Info: [ 35] : 0.023832434225078563, 0.04212104010024474
[ Info: [ 40] : 0.03853963401956037,  0.07424579803941493
[ Info: [ 45] : 0.04871072015083477,  0.07973069908465488
[ Info: [ 50] : 0.021440005325453138, 0.040678853665730035
```

### Experiment 2: LV Tuning
```julia
[ Info: [0.8, 60.0, 53.0]:97865.49427331556
[ Info: [1.0, 53.0, 55.0]:115741.3988222547
[ Info: [0.8, 59.0, 57.0]:110712.92130264739
[ Info: [0.8, 56.0, 58.0]:111992.28295250461
[ Info: [1.2, 60.0, 58.0]:134569.0998560713
[ Info: [1.0, 58.0, 58.0]:157058.74980704597
[ Info: [1.0, 58.0, 60.0]:166483.1657398089
[ Info: [1.2, 57.0, 59.0]:186799.72021781423
[ Info: [1.0, 58.0, 56.0]:108992.11709061559
[ Info: [1.6, 55.0, 58.0]:144166.4159962862
[ Info: [1.0, 52.0, 58.0]:130546.2553144216
[ Info: [0.8, 59.0, 60.0]:165716.047937061
[ Info: [1.2, 58.0, 54.0]:103913.82915528226
[ Info: [1.4, 58.0, 59.0]:183511.79158399918
[ Info: [1.2, 59.0, 60.0]:172211.98231509308
[ Info: [1.0, 56.0, 59.0]:186913.46251012463
[ Info: [1.2, 58.0, 57.0]:121145.66551966988
[ Info: [1.2, 55.0, 58.0]:133699.41660539334
[ Info: [1.4, 56.0, 58.0]:138144.8641655285
[ Info: [0.8, 57.0, 57.0]:108825.25985701059
[ Info: [0.6, 56.0, 60.0]:163848.91569703718
[ Info: [1.0, 51.0, 59.0]:197117.867421482
[ Info: [1.4, 44.0, 58.0]:142785.70773840116
[ Info: [0.8, 50.0, 57.0]:113301.07696311621
[ Info: [0.8, 41.0, 60.0]:178462.69619566025
[ Info: [0.6, 58.0, 60.0]:159260.1584854482
[ Info: [1.2, 56.0, 59.0]:186832.50888197217
[ Info: [1.2, 49.0, 58.0]:141107.66821163622
[ Info: [1.0, 48.0, 60.0]:185190.9708840424
[ Info: [0.8, 46.0, 59.0]:196407.85200101644
[ Info: [0.8, 53.0, 60.0]:177412.36204090866
[ Info: [1.0, 54.0, 58.0]:126923.29072990135
[ Info: [1.2, 51.0, 59.0]:196916.10917542147
[ Info: [1.0, 49.0, 58.0]:131564.24517326886
[ Info: [1.0, 49.0, 60.0]:185232.2287458047
[ Info: [0.8, 51.0, 59.0]:197270.54634258966
[ Info: [1.0, 53.0, 60.0]:180515.36102386884
[ Info: [1.0, 53.0, 58.0]:128908.43765510955
[ Info: [0.4, 50.0, 59.0]:200157.0447797382
[ Info: [0.6, 53.0, 59.0]:195235.87475934374
[ Info: [0.8, 51.0, 60.0]:181476.87287523045
[ Info: [1.2, 52.0, 59.0]:198742.12195189547
[ Info: [1.0, 49.0, 59.0]:199196.2903024173
[ Info: [0.8, 51.0, 58.0]:117683.83183401942
[ Info: [1.4, 45.0, 58.0]:143358.567136147
[ Info: [1.2, 49.0, 60.0]:186520.7900091071
[ Info: [1.2, 55.0, 59.0]:188565.88551626884
[ Info: [0.8, 50.0, 59.0]:199941.17867645633
[ Info: [0.4, 51.0, 60.0]:173985.2276975116
[ Info: [0.4, 52.0, 58.0]:97888.4733332291
[ Info: [0.0, 50.0, 59.0]:182037.21891648744
[ Info: [0.4, 49.0, 58.0]:96519.64629504508
[ Info: [0.4, 48.0, 60.0]:177911.11420155125
[ Info: [0.2, 50.0, 58.0]:94566.02319138811
[ Info: [0.2, 49.0, 60.0]:154757.9908292513
[ Info: [0.6, 50.0, 60.0]:180543.4283538877
[ Info: [0.6, 51.0, 58.0]:106825.52182190197
[ Info: [0.4, 50.0, 58.0]:96651.63014694813
[ Info: [0.4, 51.0, 59.0]:197234.92709593655
[ Info: [0.2, 50.0, 59.0]:182037.21891648744
[ Info: [0.4, 50.0, 60.0]:176461.4190191688
[ Info: [0.4, 49.0, 59.0]:199769.71600176266
[ Info: [0.6, 50.0, 59.0]:200114.48439059558
[ Info: [0.4, 49.0, 60.0]:177342.7940675263
[ Info: [0.4, 51.0, 58.0]:97239.78412691824
[ Info: [0.6, 49.0, 58.0]:107815.30524580939
[ Info: [0.2, 49.0, 59.0]:182037.21891648744
[ Info: [0.2, 51.0, 60.0]:151148.80584092147
[ Info: [0.6, 51.0, 59.0]:197485.83979242927
[ Info: [0.2, 49.0, 58.0]:94425.80561582986
[ Info: [0.2, 51.0, 59.0]:182037.21891648744
[ Info: [0.2, 50.0, 60.0]:154001.28593609817
[ Info: [0.6, 51.0, 60.0]:178269.88743407396
[ Info: [0.6, 49.0, 59.0]:199780.1709354723
[ Info: [0.6, 50.0, 58.0]:106851.7027322388
[ Info: [0.2, 51.0, 58.0]:94387.85776252212
================================================
MADS Run Summary
------------------------------------------------
Feasible Solution           [0.4, 50.0, 59.0]
Feasible Cost               -5.301370880252387
Infeasible Solution         nothing
Infeasible Cost             nothing

Iterations                  60
Function Evaluations        77
Cache hits                  270
Optimization Status         Mesh Precision limit

Runtime                     842.3327949047089
Search Time                 1.070000000000001e-5
Poll Time                   0.0120256
Blackbox Evaluation Time    832.8957915000053

```
 
 # Unused functions and snippets

#### JDL2
The files produced are in the order of 1 and 2 Gb per context.
```julia
using JLD2: save
save("example.jld2", Dict("sma_context"=>sma_context))
```

#### ordersForPortfolioRedistribution2
```julia
 
"""
    ordersForPortfolioRedistribution(
        sourcePortfolio::Dict{String, Float64}, 
        targetDistribution::Dict{String, Float64},
        assetPricing::Dict{String, Float64};
        curency_symbol::String= "FEX/USD", 
        account::Any=nothing,
        costPropFactor::Real=0,
        costPerTransactionFactor::Real=0,
        )
    This function generates the orders to obtain a particular value distribution on a given portfolio and static pricing.
    It can consider proportional costs by scaling the orders amount by a factor and a fixed cost for each transacted asset.
    It returns the portfolio with the desired distribution and the maximum amount of value expressed in a particular currency.

    -`sourcePortfolio::Dict{String, Float64}`: Dictionary with assets and how many units of them are present in a portfolio 
    -`targetDistribution::Dict{String, Float64}`: Desired distribution of the total value of the portfolio across the whole shares. The values do not need to add to 1, linear scaling will be used.
    -`assetPricing::Dict{String, Float64}`: Value of each share of an asset, with a corresponding value expressed in terms of a currency.
    -`curency_symbol::String= "FEX/USD"`: Symbol used to represent the currency in which the transactions are goint to take place. By default dollars, it should have value 1 on the assetPricing dictionary.
    -`account::Any=nothing`: Argument to be passed to the account field in the orders.
    -`costPropFactor::Real=0`:  Fee rate applied to the sell or purchase of any asset proportional to the value of the transaction.
    -`costPerTransactionFactor::Real=0`: Fee per transaction, every time an asset is sold/bought this fill will apply.
"""
function ordersForPortfolioRedistribution2(
    sourcePortfolio,targetDistribution,assetPricing;
    curency_symbol="FEX/USD",account::Any=nothing,costPropFactor::Real=0,
    costPerTransactionFactor::Real=0,min_shares_threshold::Real=10^-5)
    # Generate Source Distribution from Portfolio
    totalValue = sum([sourcePortfolio[x] * assetPricing[x] for x in keys(sourcePortfolio)])
    sourceDst = Dict([
        x => sourcePortfolio[x] * assetPricing[x] / totalValue for
        x in keys(sourcePortfolio)
    ])

    assetSort = [x for x in keys(sourceDst)]
    N = length(assetSort)
    curency_pos = findall(x -> x == curency_symbol, assetSort)[1]
    ShareVals = [assetPricing[x] for x in assetSort]
    propShareVal = ShareVals ./ totalValue # Share Price expressed in terms of portfolio units.

    # Problem Vectorization: D1 + P*d - Fees -> D2*k
    D1 = [get(sourceDst, x, 0) for x in assetSort] # Source
    D2 = [get(targetDistribution, x, 0) for x in assetSort] # Objective
    M = zeros(N, N)
    M[curency_pos, :] = propShareVal .* -1 # Price to pay per share (without fees)
    P = spdiagm(0 => propShareVal) + M
    FDollars = SparseVector(N, [curency_pos], [1]) # Dollar Fees Vector

    #####
    ##### Optimization Problem
    #####
    genOrderModel = Model(Ipopt.Optimizer)
    set_silent(genOrderModel)
    @variable(genOrderModel, 0 <= k) # Proportionality factor (shrinkage of portfolio)
    @variable(genOrderModel, d[1:N])  # Amount to buy/sell of each asset
    @variable(genOrderModel, propFees >= 0) # Amount Proportional Fees
    @constraint(
        genOrderModel,
        [propFees; (propShareVal .* d) .* costPropFactor] in MOI.NormOneCone(1 + N)
    ) # Implementation of norm-1 for Fees
    @variable(genOrderModel, perTransactionFixFees >= 0) # Number of transactions fees
    @constraint(
        genOrderModel, perTransactionFixFees == sum(-Î´.(d) .+ 1) * costPerTransactionFactor
    ) # Implementation of norm-1 for Fees
    @constraint(genOrderModel, d[curency_pos] == 0) # Do not buy or sell dollars (this is the currency).
    # @info "Order Gen" curency_pos
    
    @constraint(
        genOrderModel,
        D1 .+ (P * d) .- (FDollars .* (propFees + perTransactionFixFees)) .== D2 .* k
    ) # Distribution ratio
    @objective(genOrderModel, Max, k) # With variance minimization
    optimize!(genOrderModel)
    d = value.(d)

    #### 
    #### Parsing & Order Generation
    ####
    amount = Dict([
        assetSort[x] => d[x] for
        x in 1:N if (x != curency_pos) && (abs(d[x]) > min_shares_threshold)
    ])
    orders = [genOrder(x, amount[x]; account=account) for x in keys(amount)]
    return orders
end
```

#### HMM manual test
```julia
@info size(sr) size(returnHistoryWarmUp)
nHiddenStates=2

obs_seq = matrix2seq(float.(Matrix(returnHistoryStartData_Validation[:,traded_assets])))
hmm_init=random_gaussian_hmm(nHiddenStates,length(obs_seq[1]))
hmm_est, logL_evolution = baum_welch(hmm_init, obs_seq; rtol=-Inf, check_loglikelihood_increasing=false)
```

# AMC 
https://www.fool.com/investing/2021/06/06/why-amc-entertainment-skyrocketed-1604-in-may/#:~:text=The%20stock%20rallied%20about%2020,sold%20short%20heading%20into%20May.

